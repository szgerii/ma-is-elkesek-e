const e="/api/login";let t=null,r={username:null,isWatchlist:null};function n(){document.querySelector("#input-password").addEventListener("keyup",e=>{13==e.keyCode&&a()}),t=getUsername(),s()}function s(){let e=document.querySelector("#input-submitBtn");e.setAttribute("onclick",""),e.value="Kérjük várjon...",fetch("/api/users/"+t).then(async e=>({json:await e.json(),status:e.status})).then(t=>{"success"===t.json.status?(r.username=t.json.data.username,r.isWatchlist=t.json.data.showWatchlistByDefault,document.querySelector("#input-username").placeholder=r.username,document.querySelector("#input-dd-watchlist").value=""+r.isWatchlist,e.setAttribute("onclick","saveChanges();"),e.value="Változtatások mentése"):(alert("Ismeretlen hiba történt. Kérjük próbáljon meg újra bejelentkezni, vagy próbálkozzon újra később"),window.location.assign("/"))}).catch(e=>{console.debug(e),alert("Ismeretlen hiba történt. Kérjük próbáljon meg újra bejelentkezni, vagy próbálkozzon újra később"),window.location.assign("/")})}function a(){const e=document.querySelector("#input-submitBtn"),n=document.querySelector("#input-username"),s=document.querySelector("#input-password"),a=document.querySelector("#input-newPassword"),i=document.querySelector("#input-newPassword2"),u="true"==document.querySelector("#input-dd-watchlist").value,c=document.querySelector("#username-error"),d=document.querySelector("#password-error"),m=document.querySelector("#new-password-error"),b=document.querySelector("#new-password-again-error");c.innerText="",d.innerText="",m.innerText="",b.innerText="",n.style.border="",s.style.border="",a.style.border="",i.style.border="";let k=""!==n.value&&n.value!==r.username,h=u!==r.isWatchlist,j=""!==a.value;if(!k&&!h&&!j)return void(d.innerText="Egyik beállítás sem lett megváltoztatva");let y={};if(k){let e=!0;switch(o(n.value)){case"short":c.innerText="A megadott felhasználónév rövidebb, mint 3 karakter.";break;case"long":c.innerText="A megadott felhasználónév hosszabb, mint 16 karakter.";break;case"incorrect":c.innerText="A felhasználónév csak az ABC kis és nagy betűit, számokat, aláhúzást és kötőjelet tartalmazhat.";break;case"correct":e=!1}if(e)return void(n.style.border=".07em solid rgb(255, 78, 78)");y.username=n.value}if(j){let e=!0;switch(l(a.value)){case"short":return m.innerText="A megadott jelszó rövidebb, mint 6 karakter.",0;case"correct":e=!1;break;default:return 0}if(e&&(a.style.border=".07em solid rgb(255, 78, 78)"),a.value!==i.value)return void(b.innerText="A két megadott jelszó nem egyezik.");if(e)return;y.newPassword=a.value}switch(h&&(y.showWatchlistByDefault=u),l(s.value)){case"empty":return d.innerText="Kérjük adja meg a jelenlegi jelszavát az igazoláshoz!",void(s.style.border=".07em solid rgb(255, 78, 78)");case"short":return d.innerText="A megadott jelszó rövidebb, mint 6 karakter.",void(s.style.border=".07em solid rgb(255, 78, 78)");case"correct":y.password=s.value;break;default:return}e.innerText="Kérjük várjon...",fetch("/api/users/"+t,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)}).then(async e=>({json:await e.json(),status:e.status})).then(t=>{"success"===t.json.status?window.location.assign("/"):"fail"===t.json.status?401===t.status?(d.innerText="A megadott jelszó helytelen",s.style.border=".07em solid rgb(255, 78, 78)"):403===t.status?d.innerText="Hiba történt az azonosítás során. Kérjük próbáljon meg kilépni és újra bejelentkezni":409===t.status?c.innerText="Ez a felhasználónév már foglalt.":422===t.status?d.innerText="A megadott adatok formátuma helytelen":alert("Hiba történt a mentés során. Kérjük próbálkozzon újra később"):alert("Hiba történt a mentés során. Kérjük próbálkozzon újra később"),e.innerText="Változtatások mentése"}).catch(t=>{e.innerText="Változtatások mentése",console.debug(t),alert("Ismeretlen hiba történt a bejelentkezés során, kérjük probálkozzon újra később.")})}function o(e){return""==e?"empty":e.length<3?"short":e.length>16?"long":/^([a-zA-Z0-9_-]){3,16}$/.test(e)?"correct":"incorrect"}function l(e){return""==e?"empty":e.length<6?"short":"correct"}window.addEventListener?window.addEventListener("load",n):window.attachEvent&&window.attachEvent("onload",n);